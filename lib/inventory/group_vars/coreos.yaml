---
# coreos group vars

# CoreOS update group:  stable, beta, alpha
coreos_update_group: stable

# Python interpreter installed in non-standard location on CoreOS
ansible_python_interpreter: /home/core/bin/python

# Droplet creation settings
size_id: 1gb
image_id: "coreos-{{coreos_update_group}}"
region_id: nyc1

# CoreOS login ID
ansible_ssh_user: core

# Where dropins live
dropin_dir_pat: "/etc/systemd/system/%s.d"

# Swap partition size, GiB
swap_size:  2

# Container network
container_network_prefix: "{{network_prefix}}.32"
container_network_cidr: "{{container_network_prefix}}.0/24"
container_network_gateway: "{{container_network_prefix}}.1"
freeipa_client_network_addr: "{{container_network_prefix}}.2"

##################################
# Docker

# TLS
# - FreeIPA sub-CA
docker_ca: "docker"
docker_ca_subject: "CN=Docker Certificate Authority,O={{kerberos_realm}}"
# - FreeIPA service principal
docker_service_principal: "docker/{{fqdn}}@{{kerberos_realm}}"
# - Server-side cert locations
docker_ssl_dir: "{{data_volume_path}}/docker"
docker_ssl_cacert: "{{docker_ssl_dir}}/ca.pem"
docker_ssl_cert: "{{docker_ssl_dir}}/cert.pem"
docker_ssl_key: "{{docker_ssl_dir}}/key.pem"
# - Client-side cert locations (instead of ~/.docker)
docker_client_ssl_dir: "var/docker"
docker_client_ssl_cacert: "{{docker_client_ssl_dir}}/ca.pem"
docker_client_ssl_cert: "{{docker_client_ssl_dir}}/cert.pem"
docker_client_ssl_key: "{{docker_client_ssl_dir}}/key.pem"
# - Docker host remote URL
docker_tcp_port: "tcp://{{ip_addr}}:2375"
# - Client-side extra args
docker_client_extra_args: "--config=../{{docker_client_ssl_dir}} --tlsverify"
#   - Alternatively,
#docker_client_extra_args: "--tlsverify
#       --tlscacert={{docker_client_ssl_cacert}}
#       --tlscert={{docker_client_ssl_cert}}
#       --tlskey={{docker_client_ssl_key}}"


##################################
# Data volume
#
# Used for swap and etcd state

# Data volume block device
data_volume_block_device:  "{{ block_device_path_pat % 'data' }}"
# - Size in GB
data_volume_size: 4

# Data volume partition
data_volume_device: "{{ data_volume_block_device }}-part2"
data_volume_path: "/media/state"
configs_path: "{{data_volume_path}}/configs"

# Swap partition
swap_device:  "{{ data_volume_block_device }}-part1"

# Systemd unit file names for paths
swap_device_systemd_unit: "{{swap_device|systemd_escape}}.swap"
data_volume_systemd_unit: "{{data_volume_path|systemd_escape}}.mount"

#################################
# etcd configuration

# TLS
# - FreeIPA sub-CA
etcd_ca: "etcd"
etcd_ca_subject_short: "Etcd Certificate Authority"
etcd_ca_subject: "CN={{etcd_ca_subject_short}},O={{kerberos_realm}}"
# - FreeIPA service principal
etcd_service_principal: "etcd/{{fqdn}}@{{kerberos_realm}}"
# - Cert locations; accessible from mount in etcd-member-wrapper
etcd_cert_dir: "{{ data_volume_path }}/etcd"
etcd_ssl_cert: "{{ etcd_cert_dir }}/cert.pem"
etcd_ssl_key: "{{ etcd_cert_dir }}/key.pem"
etcd_ssl_cacert: "{{ etcd_cert_dir }}/ca.pem"

# Endpoints
etcd_endpoints:
  "{{groups.coreos|formatmapstr('https://{0}.%s:2379' % domain_name,',')}}"

# etcdctl
etcdctl_command:
  "etcdctl
  --ca-file {{etcd_ssl_cacert}}
  --cert-file {{etcd_ssl_cert}}
  --key-file {{etcd_ssl_key}}
  --endpoints={{etcd_endpoints}}"

#################################
# Kubernetes configuration

kubernetes_master: "{{master_host}}"
kubernetes_network: "{{network_prefix}}.0.0/{{cidr_prefix}}"
kubernetes_version: "v1.7.0_coreos.0"

# FIXME
kubernetes_pod_network:  10.2.0.0/16
kubernetes_service_ip_range:  10.3.0.0/24
kubernetes_service_ip: 10.3.0.1
kubernetes_dns_service_ip: 10.3.0.10

#################################
# Cluster configuration

# Cluster configuration
initial_cluster:
  "{{[groups.coreos_master[0],hostname]|formatmapstr(
  '{0}=https://{0}.%s:2380' % domain_name,',')}}"
initial_cluster_state:
  "{{ (hostname==groups.coreos_master[0])|ternary('new','existing') }}"

