---

# - include: add-a-record.yaml
# Vars: zone, record, arecord

- name: "IPA check {{zone}} zone {{record}} entry {{arecord}} A record"
  shell: "{{ipa_exec}} ipa dnsrecord-show --raw --all {{zone}} {{record}}
           |& grep -iq 'arecord. {{arecord}}$' && echo yes || echo no"
  register: ipa_record_a_check
  changed_when: ipa_record_a_check.stdout == 'no'
  tags:
    - configure
    - dns

- name: "IPA add {{zone}} zone {{record}} entry {{arecord}} A record"
  shell: "{{ipa_exec}} ipa dnsrecord-add {{zone}} {{record}} --a-rec={{arecord}}"
  when: ipa_record_a_check.changed
  tags:
    - configure
    - dns
