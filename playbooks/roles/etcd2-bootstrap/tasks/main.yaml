---
# Configure etcd2 on CoreOS

- name:  Check if etcd2 is bootstrapped
  # shell:  "test -f ~/.etcd2-bootstrapped && echo yes || echo no"
  shell:  "etcdctl member list | grep -q 'name={{hostname|quote}} '
             && echo yes || echo no"
  register:  etcd2_check
  changed_when:  False

- name:  Set etcd2 fact
  set_fact:
    etcd2_configured:  "{{ etcd2_check.stdout == 'yes' }}"

- name: Debug etcd2 configured
  debug:
    var: etcd2_configured

- name:  Check if fleet is running
  shell:  "fleetctl list-machines >&/dev/null && echo yes || echo no"
  register:  fleet_check
  changed_when:  False
  when:  etcd2_check

- name:  Set fleet fact
  set_fact:
    fleet_configured:  "{{ etcd2_check and fleet_check.stdout == 'yes' }}"

- name: Debug fleet configured
  debug:
    var: fleet_configured

- include: "{{ operation }}.yaml"
