---
#################################
# Setup flanneld deployment

#
# Configure flanneld service
#
- block:

    - name:  "Start flanneld.service"
      systemd:
        name: flanneld.service
        enabled: true
        masked: false
        state: started
      register: flanneld_service

    - name:  "Start flannel-docker-opts.service"
      systemd:
        enabled: true
        masked: false
        name: flannel-docker-opts.service
        state: started
      register: flannel_docker_opts_service

    - name:  "Restart docker.service"
      systemd:
        name: docker.service
        state: "restart"
      when:  flannel_docker_opts_service.changed or flanneld_service.changed

  when:  hostname == master_host
  become: true
  tags:
    - flannel-config
